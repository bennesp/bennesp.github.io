<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>LDAP Snippets | bennesp</title>
<meta name=keywords content="snippet,ldap,cli,authentication">
<meta name=description content="Useful snippet for managing LDAP from CLI">
<meta name=author content="Me">
<link rel=canonical href=https://bennesp.github.io/posts/ldap-snippets/>
<meta name=google-site-verification content="v7Xf_l3PpxLV6QMfXaclOrUym7CgrmzJEBFXrAzWnZ4">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.e012190c622dd4890ec7d2d35a52674a545d936b7bfd85be1a6a4f4f50c0adca.css integrity="sha256-4BIZDGIt1IkOx9LTWlJnSlRdk2t7/YW+GmpPT1DArco=" rel="preload stylesheet" as=style>
<link rel=preload href=/imgs/bennesp.png as=image>
<link rel=icon href=https://bennesp.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://bennesp.github.io/favicon/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://bennesp.github.io/favicon/favicon-32x32.png>
<link rel=apple-touch-icon href=https://bennesp.github.io/favicon/apple-touch-icon.png>
<link rel=mask-icon href=https://bennesp.github.io/favicon/apple-touch-icon.png>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-189033864-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="LDAP Snippets">
<meta property="og:description" content="Useful snippet for managing LDAP from CLI">
<meta property="og:type" content="article">
<meta property="og:url" content="https://bennesp.github.io/posts/ldap-snippets/">
<meta property="og:image" content="https://bennesp.github.io/imgs/cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-25T10:51:48+01:00">
<meta property="article:modified_time" content="2021-11-25T10:51:48+01:00"><meta property="og:site_name" content="bennesp">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://bennesp.github.io/imgs/cover.png">
<meta name=twitter:title content="LDAP Snippets">
<meta name=twitter:description content="Useful snippet for managing LDAP from CLI">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bennesp.github.io/posts/"},{"@type":"ListItem","position":2,"name":"LDAP Snippets","item":"https://bennesp.github.io/posts/ldap-snippets/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"LDAP Snippets","name":"LDAP Snippets","description":"Useful snippet for managing LDAP from CLI","keywords":["snippet","ldap","cli","authentication"],"articleBody":" ℹ️ Every snippet that uses a file can be onelined using cat, like: cat ldif file content here EOF  Commands In the snippets below we use some arguments. Here are the arguments per-tool, explained:\nldapadd, ldapmodify, ldapsearch  -D \"cn=admin,dc=example,dc=org\" is the username, called “Binding DN” -w admin is the password -f filename.ldif specify which LDIF file to use to add/modify/search  ldapsearch only  -b \"dc=example,dc=org\" is the base address where to start the search  Snippets Create a new user 1 2 3 4 5 6 7 8 9 10 11 12 13  # file.ldif # mandatory: dn: cn=billy,dc=example,dc=org cn: billy objectClass: inetOrgPerson sn: Jones # sn=Surname userPassword: billy # userPassword can be hashed with slappasswd, see next snippet # userPassword: {SSHA}g1RqOK2kk/nV241xD2BZRdxdVuRqGNnG # optionally: uid: 123 givenName: Billy \u0026 Mandy mail: billy@example.org   ldapadd -D \"cn=admin,dc=example,dc=org\" -w admin -f file.ldif Generate hashed password slappasswd -g # generates random non hashed password slappasswd # hashes password with default hash (like SSHA = Salted SHA) slappasswd -h '{CRYPT}' # generates hashed password with CRYPT hash algorithm # oneline: PASSWORD=$(slappasswd -g) \u0026\u0026 echo $PASSWORD \u0026\u0026 slappasswd -s \"$PASSWORD\" Export all the readable objects ldapsearch -D \"cn=admin,dc=example,dc=org\" -w admin -b \"dc=example,dc=org\" Allow every authenticated user to read the directory  dn is the selector of the database (you could have hdb instead of mdb if your LDAP is older) olcAccess  {1} is the priority between all the other rules (can be negative, rules are applied from the smallest number to the higher one) to * is the resource to which the rule applies, could be to dn.base=\"dc=example,dc=org\" or similar, see docs for more info by anonymous auth allows every un-authenticated user to authenticate by users read allows every authenticated user to read the object specified in the to clause    # config.ldif dn: olcDatabase={1}mdb,cn=config changetype: modify add: olcAccess olcAccess: {1}to * by anonymous auth by users read ldapmodify -D \"cn=admin,cn=config\" -w config -f config.ldif ","wordCount":"319","inLanguage":"en","image":"https://bennesp.github.io/imgs/cover.png","datePublished":"2021-11-25T10:51:48+01:00","dateModified":"2021-11-25T10:51:48+01:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bennesp.github.io/posts/ldap-snippets/"},"publisher":{"@type":"Organization","name":"bennesp","logo":{"@type":"ImageObject","url":"https://bennesp.github.io/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://bennesp.github.io/ accesskey=h title="bennesp (Alt + H)">
<img src=/imgs/bennesp.png alt=logo aria-label=logo height=32>bennesp</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://bennesp.github.io/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
<li>
<a href=https://bennesp.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://bennesp.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://bennesp.github.io/posts/>Posts</a></div>
<h1 class=post-title>
LDAP Snippets
</h1>
<div class=post-meta><span title="2021-11-25 10:51:48 +0100 CET">25 November 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/bennesp/bennesp.github.io/blob/master/content/posts/002-ldap/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header>
<div class=post-content>
<div class="alert alert-info" role=alert> ℹ️ Every snippet that uses a file can be onelined using cat, like:
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh>  cat <span style=color:#2aa198>&lt;&lt; EOF | ldapcommand
</span><span style=color:#2aa198>  ldif file content here
</span><span style=color:#2aa198>  EOF</span></code></pre></div>
</div>
<h1 id=commands>Commands<a hidden class=anchor aria-hidden=true href=#commands>#</a></h1>
<p>In the snippets below we use some arguments.
Here are the arguments per-tool, explained:</p>
<h2 id=ldapadd-ldapmodify-ldapsearch><code>ldapadd</code>, <code>ldapmodify</code>, <code>ldapsearch</code><a hidden class=anchor aria-hidden=true href=#ldapadd-ldapmodify-ldapsearch>#</a></h2>
<ul>
<li><code>-D "cn=admin,dc=example,dc=org"</code> is the username, called &ldquo;Binding DN&rdquo;</li>
<li><code>-w admin</code> is the password</li>
<li><code>-f filename.ldif</code> specify which LDIF file to use to add/modify/search</li>
</ul>
<h2 id=ldapsearch-only><code>ldapsearch</code> only<a hidden class=anchor aria-hidden=true href=#ldapsearch-only>#</a></h2>
<ul>
<li><code>-b "dc=example,dc=org"</code> is the base address where to start the search</li>
</ul>
<h1 id=snippets>Snippets<a hidden class=anchor aria-hidden=true href=#snippets>#</a></h1>
<h2 id=create-a-new-user>Create a new user<a hidden class=anchor aria-hidden=true href=#create-a-new-user>#</a></h2>
<div class=highlight><div style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#495050">13
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=color:#586e75># file.ldif</span>
<span style=color:#586e75># mandatory:</span>
<span style=color:#268bd2>dn</span>: cn=billy,dc=example,dc=org
<span style=color:#268bd2>cn</span>: billy
<span style=color:#268bd2>objectClass</span>: inetOrgPerson
<span style=color:#268bd2>sn</span>: Jones <span style=color:#586e75># sn=Surname</span>
<span style=color:#268bd2>userPassword</span>: billy
<span style=color:#586e75># userPassword can be hashed with slappasswd, see next snippet</span>
<span style=color:#586e75># userPassword: {SSHA}g1RqOK2kk/nV241xD2BZRdxdVuRqGNnG</span>
<span style=color:#586e75># optionally:</span>
<span style=color:#268bd2>uid</span>: <span style=color:#2aa198>123</span>
<span style=color:#268bd2>givenName</span>: Billy &amp; Mandy
<span style=color:#268bd2>mail</span>: billy@example.org</code></pre></td></tr></table>
</div>
</div>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh>ldapadd -D <span style=color:#2aa198>&#34;cn=admin,dc=example,dc=org&#34;</span> -w admin -f file.ldif
</code></pre></div><h2 id=generate-hashed-password>Generate hashed password<a hidden class=anchor aria-hidden=true href=#generate-hashed-password>#</a></h2>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh>slappasswd -g <span style=color:#586e75># generates random non hashed password</span>

slappasswd <span style=color:#586e75># hashes password with default hash (like SSHA = Salted SHA)</span>

slappasswd -h <span style=color:#2aa198>&#39;{CRYPT}&#39;</span> <span style=color:#586e75># generates hashed password with CRYPT hash algorithm</span>

<span style=color:#586e75># oneline:</span>
<span style=color:#268bd2>PASSWORD</span><span style=color:#719e07>=</span><span style=color:#719e07>$(</span>slappasswd -g<span style=color:#719e07>)</span> <span style=color:#719e07>&amp;&amp;</span> <span style=color:#b58900>echo</span> <span style=color:#268bd2>$PASSWORD</span> <span style=color:#719e07>&amp;&amp;</span> slappasswd -s <span style=color:#2aa198>&#34;</span><span style=color:#268bd2>$PASSWORD</span><span style=color:#2aa198>&#34;</span>
</code></pre></div><h2 id=export-all-the-readable-objects>Export all the readable objects<a hidden class=anchor aria-hidden=true href=#export-all-the-readable-objects>#</a></h2>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh>ldapsearch -D <span style=color:#2aa198>&#34;cn=admin,dc=example,dc=org&#34;</span> -w admin -b <span style=color:#2aa198>&#34;dc=example,dc=org&#34;</span>
</code></pre></div><h2 id=allow-every-authenticated-user-to-read-the-directory>Allow every authenticated user to read the directory<a hidden class=anchor aria-hidden=true href=#allow-every-authenticated-user-to-read-the-directory>#</a></h2>
<ul>
<li><code>dn</code> is the selector of the database (you could have <code>hdb</code> instead of <code>mdb</code> if your LDAP is older)</li>
<li><code>olcAccess</code>
<ul>
<li><code>{1}</code> is the priority between all the other rules (can be negative, rules are applied from the smallest number to the higher one)</li>
<li><code>to *</code> is the resource to which the rule applies, could be <code>to dn.base="dc=example,dc=org"</code> or similar, <a href=https://www.openldap.org/doc/admin24/access-control.html>see docs</a> for more info</li>
<li><code>by anonymous auth</code> allows every un-authenticated user to authenticate</li>
<li><code>by users read</code> allows every authenticated user to read the object specified in the <code>to</code> clause</li>
</ul>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=color:#586e75># config.ldif</span>
<span style=color:#268bd2>dn</span>: olcDatabase={1}mdb,cn=config
<span style=color:#268bd2>changetype</span>: modify
<span style=color:#268bd2>add</span>: olcAccess
<span style=color:#268bd2>olcAccess</span>: {<span style=color:#2aa198>1</span>}to *
  by anonymous auth
  by users read
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh>ldapmodify -D <span style=color:#2aa198>&#34;cn=admin,cn=config&#34;</span> -w config -f config.ldif
</code></pre></div>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://bennesp.github.io/tags/snippet/>snippet</a></li>
<li><a href=https://bennesp.github.io/tags/ldap/>ldap</a></li>
<li><a href=https://bennesp.github.io/tags/cli/>cli</a></li>
<li><a href=https://bennesp.github.io/tags/authentication/>authentication</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://bennesp.github.io/posts/ldap-setup/>
<span class=title>Next Page »</span>
<br>
<span>LDAP Setup</span>
</a>
</nav>
</footer>
</article>
</main>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><footer class=footer>
© 2021 <a href=https://bennesp.github.io/>bennesp</a>
</footer>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>